# Предсказание коэффициента восстановления золота  

## Задача

Есть данные с параметрами химического состава сырья на разных этапах очистки золотой руды, разбитые на два датасета - обучающий и тестовый (так же присутствует объединяющий их датасет с исходными данными). Нужно __обучить модель для предсказания коэффициента восстановления золота из золотосодержащей руды__. Качество модели опрделеяется метрикой **Итоговый sMAPE**, рассчитывающейся как сумма 25% sMAPE_rough и 75% sMAPE_final (формула указана в начале проекта), где индексы rougher и final означают этапы обработки руды, для которых расчитывается **sMAPE**.

Формула расчета показателя **sMAPE** для обоих этапов - rougher и final - также приведена в начале проекта.

$$
sMAPE = {{{1}\over {N}} \sum_{i=1}^N {|{y - \hat y|}\over{(|y| + |\hat y|) / 2}} \times 100\% }
$$

Золотая руда проходит этап флотации, первый этап очистки и второй этап очистки, на каждом из которых образуются концентрат, который идет на следующий этап, и отвальные хвосты (tails). Для каждого из этапов есть несколько типов параметров (input - параметры поступающего на этап сырья, output - параметры выхода этапа, state - параметры текущего состояния сырья, и calculation - расчетные характеристики), и для каждого типа параметров есть параметры, включающие в себя показатели концентрации металлов в сырье, концентрацию реагентов, физико-химические характеристики вроде объема воздуха, уровня жидкости и размера гранул и т.д. 

Целевым признаком в нашем случае для обоих этапов rougher (флотация) и (final) является показатель **Recovery** - показатель эффективности обогащения (формула указана в начале проекта).

Заказчик попросил __проверить расчет коэффициента восстановления в данных__.

Также заказчик попросил __произвести анализ__ изменения концентрации металлов в зависимости от этапа, суммарной концентрации веществ и распределения гранул сырья.

## Описание проекта
В ходе проекта были использованы библиотеки:
- *Pandas*, *NumPy*;
- Возможности *scikit_learn*: алгоритмы регрессии *LinearRegression*,*DecisionTreeRegressor*, *RandomForestRgeressor*; *KNNImputer* для обработки пропусков; несмотря на то, что заказчик передал нам формулу расчета ключевой метрики, мы так же отследим *mean_squared_error*, *mean_absolute_error*, *r2_score* из *sclearn.metrics*;
- для создания графиков на этапе исследования использовались *matplotlib* и *seaborn*.

После загрузки данных расчет коэффициента восстановления был перепроверен. Были обнаружены пропуски в ряде строк и отсутствие ряда столбцов в тестовом датасете (и их наличие в обучающем и исходном).

Тип данных ряда признаков был изменен на datetime. Пропуски были заполнены в исходном датасете. Строки, вошедшие в тестовый датасет, были отмечены в исходном, и потом именно они вошли в тестовую выборку, благодаря чему удалось соблюсти установленные заказчиком условия.  

Был проведен исследовательский анализ изменения концентрации металлов в зависимости от этапа, вывод: концентрация от этапа к этапу стабильно растет у золота, у остальных металов в руде падает или перестает расти в ходе обработки.  
Был проведен анализ распределения гранул сырья тестовой и обучающей выборок, вывод: распределения в целом похожи, оба скошены влево, тестовая - сильнее, что можно объяснить меньшим количеством наблюдений.
Был проведен анализ суммарной концентрации сырья после каждого этапа, вывод: были обнаружены аномальные значения с нулевой концентрацией (около 9% от выборки), они были удалены.

Затем был произведен подбор моделей. Поскольку ключевая метрика являляется агрегатом метрик ключевого признака Recovery на двух этапах, фактически, необходимо было подобрать две модели. Одной из них стала модель на решающем дереве, которая неожиданно показала лучший результат, чем случайный лес, вторым - модель на случайном лесе.  
Модели продемонстрировали не самые высокие показатели обычных метрик, но установленный заказчиком порог sMAPE был преодолен, а проверка на адекватность пройдена.  
